<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>The Ale Tavern</title>

        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <style>
         body { padding-top:50px; }
        </style>

    </head>

    <body>

        <div class="container">
            <div class="jumbotron text-center">
                <h1>Future of Ale Tavern</h1>
		            <h3>A place to play games with friends, in person.</h3>
            </div>
        </div>

        <div class="container">
            <div class="jumbotron text-center">
                <h4 id="rMessage"></h4>

                <input id="sMessage" type="text" autocomplete="off">
                <input id="sendMessageToAll"type="button" name="submit" value="sendMessageToAll()" onclick="sendMessageToAll();" />
                <input id="sendMessageToHost"type="button" name="submit" value="sendMessageToHost()" onclick="sendMessageToHost();" />
                <input id="joinGame"type="button" name="submit" value="joinGame()" onclick="joinGame();" />
                <input id="createGame"type="button" name="submit" value="createGame()" onclick="createGame();" />
            </div>
        </div>

        <div class="container">
            <ul id ="messages"></ul>
        </div>


        <script>
         var wsPath = "ws://" +  window.location.host + "/game";
         var gameWebSocket = new WebSocket(wsPath);

         var input = document.getElementById("sMessage");
         var output = document.getElementById("messages");


         // ***************** Event listeners **********************************
         // Pressing enter will default to "sendMessage()"
         input.addEventListener("keydown", function(event){
             if (event.keyCode === 13)
             {
                 event.preventDefault();
                 document.getElementById("sendMessageToAll").click();
             }
         });

         // Listen for messages
         gameWebSocket.addEventListener('message', newMessageHandler);

         function newMessageHandler(event){

             msgObj = JSON.parse(event.data);
             console.log(msgObj);

             if(msgObj.type == "CREATEGAME")
             {
                 gameId = msgObj.data
                 sessionStorage.setItem("playerId", msgObj.playerId); // Consider using session storage
             }
             if(msgObj.type == "JOINGAME")
             {
                 gameId = msgObj.data
                 sessionStorage.setItem("playerId", msgObj.playerId); // Consider using session storage
             }

             if(msgObj.type == "MESSAGEGAME")
             {
                 var listNode = document.createElement("li");
                 listNode.innerHTML = msgObj.data;
                 output.appendChild(listNode);
             }
         }


         // ********************* BUTTON FUNCTIONS *******************************
         function createGame(){
             var createMessageObj = {type:"CREATEGAME"};
             gameWebSocket.send(JSON.stringify(createMessageObj));
         }

         function joinGame(){
             var joinMessageObj = {type:"JOINGAME", data:getAndClearInput()};
             gameWebSocket.send(JSON.stringify(joinMessageObj));
         }

         function sendMessageToAll(){
             var sendMessageObj = {type:"MESSAGEALLGAME", playerId:sessionStorage.getItem("playerId"), data:getAndClearInput()}
             gameWebSocket.send(JSON.stringify(sendMessageObj));
         }

         function sendMessageToHost(){
             var sendMessageObj = {type:"MESSAGEHOSTGAME", playerId:sessionStorage.getItem("playerId"), data:getAndClearInput()}
             gameWebSocket.send(JSON.stringify(sendMessageObj));
         }



         // ******************* HELPER FUNCTIONS *******************************
         function getAndClearInput(){
             var val = input.value;
             input.value = "";
             return val;
         }

        </script>

    </body>
</html>

